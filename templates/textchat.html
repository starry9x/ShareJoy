{% extends "base.html" %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/textchat.css') }}">
{% endblock %}

{% block content %}
<div class="section-box">
  <!-- Arrow pinned left -->
  <a href="{{ url_for('messages') }}" class="btn btn-link p-0 back-arrow">
    <i class="fa-solid fa-arrow-left"></i>
  </a>

  <!-- Centered group -->
  <div class="text-pfp-container">
    <img src="{{ url_for('static', filename=(contact.image_url if contact.image_url else 'images/default_pfp.jpg')) }}"
         alt="{{ contact.name }} picture" class="pfp">
    <span class="contact-name fw-semibold">{{ contact.name }}</span>
  </div>
</div>

<!-- Wrapper for chat + pane -->
<div class="chat-wrapper">
  <div class="chat-container" id="chatContainer">
    <div class="messages-area">
      {% for message in messages %}
        <div class="message {% if message.username == 'me' %}sent{% else %}received{% endif %}">
          <div>{{ message.content }}</div>
          <small>{{ message.timestamp|sgtime }}</small>
        </div>
      {% endfor %}
    </div>

    <form method="POST" class="input-area">
      <input type="text" name="content" class="message-input" placeholder="Type a message..." required>
      <button type="button" id="togglePaneButton" class="btn btn-danger cta-btn mt-2 mt-md-0 me-0 me-md-2 fw-semibold" onclick="togglePane()">Open chat functions</button>
      <button type="submit" class="send-button">Send</button>
    </form>
  </div>

  <!-- Right pane -->
  <div class="right-pane" id="rightPane">
    <h5>Chat Functions</h5>
    <div class="convo-starters">
      <p>Click on a conversation starter to begin a topic! </p>
      <button type="button" class="btn btn-sm btn-outline-secondary mb-4" onclick="insertText('What was your favourite memory of us together?')">What was your favourite memory of us together?</button>
      <button type="button" class="btn btn-sm btn-outline-secondary mb-4" onclick="insertText('Share your most memorable childhood experience.')">Share your most memorable childhood experience.</button>
      <button type="button" class="btn btn-sm btn-outline-secondary mb-4" onclick="insertText('Do you remember when we used to [insert text here]?')">Do you remember when we used to...</button>
      <button type="button" class="btn btn-sm btn-outline-secondary mb-4" onclick="insertText('What are your favourite hawker foods?')">What are your favourite hawker foods?</button>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
function togglePane() {
  const pane = document.getElementById("rightPane");
  const chat = document.getElementById("chatContainer");
  const toggleButton = document.getElementById("togglePaneButton");

  pane.classList.toggle("open");
  chat.classList.toggle("shrunk");

  if (pane.classList.contains("open")) {
    toggleButton.textContent = "Close chat functions";
  } else {
    toggleButton.textContent = "Open chat functions";
  }
}

function insertText(text) {
  const inputField = document.querySelector(".message-input");
  inputField.value = text; // Insert the text into the input field
  inputField.focus(); // Focus the input field for user convenience
}
</script>
{% endblock %}
