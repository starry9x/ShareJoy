{% extends "base.html" %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/profile.css') }}">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
{% endblock %}

{% block content %}
<div class="profile-page">

  <!-- =====================
       PROFILE CARD
  ====================== -->
  <section class="profile-card">

    <div class="profile-top">

      <div class="profile-left">
        <div class="avatar-container">
          <img id="profileImage" src="https://static.vecteezy.com/system/resources/thumbnails/002/534/006/small/social-media-chatting-online-blank-profile-picture-head-and-body-icon-people-standing-icon-grey-background-free-vector.jpg" class="avatar" alt="Profile Picture">
          <div class="avatar-overlay">
            <button id="uploadBtn" class="avatar-btn">
              <i class="fa-solid fa-camera"></i>
            </button>
            <button id="deleteBtn" class="avatar-btn delete-btn" style="display: none;">
              <i class="fa-solid fa-trash"></i>
            </button>
          </div>
          <input type="file" id="imageUpload" accept="image/*" style="display: none;">
        </div>

        <div class="profile-info">
          <h1 class="profile-name">Leon Kennedy</h1>

          <div class="info">
            <i class="fa-solid fa-envelope"></i>
            leon.kennedy@gmail.com
          </div>

          <div class="info">
            <i class="fa-solid fa-calendar"></i>
            Joined March 2023
          </div>

          <div class="info">
            <i class="fa-solid fa-user"></i>
            "I love running and cooking"
          </div>
        </div>
      </div>

      <div class="profile-right">
        <span class="tag">Youth</span>

        <!-- LOG OUT -->
        <a href="/loginpage" class="logout-btn">
          Log Out
        </a>
      </div>

    </div>

    <!-- HORIZONTAL LINE -->
    <hr class="divider">

    <!-- STATS -->
    <div class="stats">
      <div>
        <strong>142</strong>
        <span>Posts</span>
      </div>
      <div>
        <strong>67</strong>
        <span>Followers</span>
      </div>
      <div>
        <strong>167</strong>
        <span>Following</span>
      </div>
    </div>

    <!-- HORIZONTAL LINE -->
    <hr class="divider">

    <!-- ACTIONS -->
    <div class="actions">
      <button id="editProfile">
        <i class="fa-solid fa-pen-to-square"></i> <span id="edit-btn-text">Edit Profile</span>
      </button>
      <button id="shareProfile">
        <i class="fa-solid fa-share-nodes"></i> Share Profile
      </button>
    </div>

  </section>

  <!-- =====================
       SETTINGS SECTION
  ====================== -->
  <section class="settings">
    <h2>Account Settings & Features</h2>

    <div class="settings-grid">

      <!-- Accessibility -->
      <div class="setting-card">
        <div class="icon-wrapper accessibility">
          <i class="fa-solid fa-universal-access"></i>
        </div>
        
        <h3>Accessibility Settings</h3>
        <p class="setting-description">
          Make the page comfortable for you. Adjust the text, colours, or layout with simple tools.
        </p>

        <ul class="setting-list">
          <li>Change font size of webpage</li>
          <li>High contrast mode</li>
          <li>Text-to-speech function</li>
        </ul>

        <a href="/accessibility">Open →</a>
      </div>

      <!-- Safety & Privacy -->
      <div class="setting-card">
        <div class="icon-wrapper safety">
          <i class="fa-solid fa-shield-halved"></i>
        </div>
        
        <h3>Safety & Privacy</h3>
        <p class="setting-description">
          Choose what you want to share and keep your account safe in just a few easy steps.
        </p>

        <ul class="setting-list">
          <li>Guardian oversight profile (optional)</li>
          <li>Privacy controls</li>
          <li>Login security</li>
          <li>Data sharing preferences</li>
        </ul>

        <a href="/safetynprivacy">Open →</a>
      </div>

      <!-- Achievements -->
      <div class="setting-card">
        <div class="icon-wrapper achievements">
          <i class="fa-solid fa-trophy"></i>
        </div>
        
        <h3>Achievements & Progress</h3>
        <p class="setting-description">
          See your activities and achievements. Stay motivated as you complete more together.
        </p>

        <ul class="setting-list">
          <li>Trophy and badges collection</li>
          <li>Progress tracking for consistency</li>
          <li>Activity completion stats</li>
          <li>Milestone celebrations</li>
        </ul>

        <a href="/achievements">Open →</a>
      </div>

    </div>
  </section>

  <!-- =====================
       ABOUT ME
  ====================== -->
  <section class="about">
    <h2>
      <i class="fa-solid fa-circle-info"></i> About Me
    </h2>
    <hr class="about-divider">

    <div class="about-box">
      <strong>Bio</strong>
      <p id="bio-text">Student passionate about volunteering. Love running and cooking.</p>
      <textarea id="bio-edit" class="edit-textarea" style="display: none;">Student passionate about volunteering. Love running and cooking.</textarea>
    </div>

    <div class="about-box">
      <strong>Work</strong>
      <p id="work-text">Working part time at Starbucks.</p>
      <textarea id="work-edit" class="edit-textarea" style="display: none;">Working part time at Starbucks.</textarea>
    </div>

    <div class="about-box">
      <strong>Education</strong>
      <p id="education-text">Nanyang Polytechnic, Diploma in Business and Financial Technology</p>
      <textarea id="education-edit" class="edit-textarea" style="display: none;">Nanyang Polytechnic, Diploma in Business and Financial Technology</textarea>
    </div>
  </section>

</div>

<!-- =====================
     SCRIPT
====================== -->
<script>
  let isEditMode = false;
  const defaultImage = "https://static.vecteezy.com/system/resources/thumbnails/002/534/006/small/social-media-chatting-online-blank-profile-picture-head-and-body-icon-people-standing-icon-grey-background-free-vector.jpg";

  // ===== EDIT PROFILE FUNCTIONALITY =====
  document.getElementById("editProfile").addEventListener("click", () => {
    isEditMode = !isEditMode;
    
    const editBtn = document.getElementById("edit-btn-text");
    const bioText = document.getElementById("bio-text");
    const bioEdit = document.getElementById("bio-edit");
    const workText = document.getElementById("work-text");
    const workEdit = document.getElementById("work-edit");
    const educationText = document.getElementById("education-text");
    const educationEdit = document.getElementById("education-edit");
    
    if (isEditMode) {
      // Switch to edit mode
      editBtn.textContent = "Save Profile";
      
      // Hide text, show textareas
      bioText.style.display = "none";
      bioEdit.style.display = "block";
      workText.style.display = "none";
      workEdit.style.display = "block";
      educationText.style.display = "none";
      educationEdit.style.display = "block";
    } else {
      // Save changes and switch back to view mode
      editBtn.textContent = "Edit Profile";
      
      // Update text content from textareas
      bioText.textContent = bioEdit.value;
      workText.textContent = workEdit.value;
      educationText.textContent = educationEdit.value;
      
      // Show text, hide textareas
      bioText.style.display = "block";
      bioEdit.style.display = "none";
      workText.style.display = "block";
      workEdit.style.display = "none";
      educationText.style.display = "block";
      educationEdit.style.display = "none";
    }
  });
  
  // ===== SHARE PROFILE FUNCTIONALITY =====
  document.getElementById("shareProfile").addEventListener("click", () => {
    alert("Share profile (prototype)");
  });

  // ===== PROFILE PICTURE FUNCTIONALITY =====
  const profileImage = document.getElementById("profileImage");
  const uploadBtn = document.getElementById("uploadBtn");
  const deleteBtn = document.getElementById("deleteBtn");
  const imageUpload = document.getElementById("imageUpload");

  // Check if there's a saved image in localStorage
  const savedImage = localStorage.getItem("profileImage");
  if (savedImage && savedImage !== defaultImage) {
    profileImage.src = savedImage;
    deleteBtn.style.display = "block";
  }

  // Upload button - trigger file input
  uploadBtn.addEventListener("click", () => {
    imageUpload.click();
  });

  // Handle image upload
  imageUpload.addEventListener("change", (e) => {
    const file = e.target.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = (event) => {
        const imageData = event.target.result;
        profileImage.src = imageData;
        localStorage.setItem("profileImage", imageData);
        deleteBtn.style.display = "block";
      };
      reader.readAsDataURL(file);
    }
  });

  // Delete button - restore default image
  deleteBtn.addEventListener("click", () => {
    profileImage.src = defaultImage;
    localStorage.removeItem("profileImage");
    deleteBtn.style.display = "none";
    imageUpload.value = ""; // Clear file input
  });
</script>
{% endblock %}