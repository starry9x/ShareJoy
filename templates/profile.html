{% extends "base.html" %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/profile.css') }}">
{% endblock %}

{% block content %}
<div class="profile-container">
    <!-- Profile Header Section -->
    <section class="profile-header">
        <div class="profile-pic-section">
            <img src="{{ url_for('static', filename='images/default-avatar.png') }}" alt="Profile Picture" class="profile-pic" id="profilePicture">
            <button class="change-pic-btn" onclick="openModal()">
                <i class="fas fa-camera"></i> Change Photo
            </button>
        </div>
        
        <div class="profile-info">
            <h1 class="profile-name" id="profileName">{{ current_user.name if current_user else 'Leon Kennedy' }}</h1>
            <div class="profile-email">
                <i class="fas fa-envelope"></i>
                <span id="profileEmail">{{ current_user.email if current_user else 'leon.kennedy@gmail.com' }}</span>
            </div>
            <div class="joined-date">
                <i class="far fa-calendar-alt"></i> Joined March 2023
            </div>
            
            <p class="profile-quote" id="profileQuote">"I love running and cooking"</p>
            
            <div class="profile-stats">
                <div class="stat-item">
                    <div class="stat-number" id="postCount">142</div>
                    <div class="stat-label">Posts</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="followerCount">67</div>
                    <div class="stat-label">Followers</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="followingCount">167</div>
                    <div class="stat-label">Following</div>
                </div>
            </div>
            
            <div class="action-buttons">
                <button class="btn btn-primary" onclick="openModal()">
                    <i class="fas fa-edit"></i> Edit Profile
                </button>
                <a href="{{ url_for('logout') }}" class="btn btn-secondary">
                    <i class="fas fa-sign-out-alt"></i> Log Out
                </a>
            </div>
        </div>
    </section>
    
    <!-- Settings Section -->
    <section class="settings-section">
        <h2 class="section-title">
            <i class="fas fa-cog"></i> Account Settings & Features
        </h2>
        
        <div class="settings-grid">
            <!-- Accessibility Settings -->
            <div class="setting-card">
                <h3 class="setting-title">Accessibility Settings</h3>
                <p class="setting-description">Make the page comfortable for you. Adjust the text, colours, or layout with simple tools.</p>
                
                <ul class="setting-features">
                    <li><i class="fas fa-check"></i> Change font size of webpage</li>
                    <li><i class="fas fa-check"></i> High contrast mode</li>
                    <li><i class="fas fa-check"></i> Text-to-speech function</li>
                </ul>
                
                <a href="/accessibility" class="open-btn">
                    Open <i class="fas fa-arrow-right"></i>
                </a>
            </div>
            
            <!-- Safety & Privacy -->
            <div class="setting-card">
                <h3 class="setting-title">Safety & Privacy</h3>
                <p class="setting-description">Choose what you want to share and keep your account safe in just a few easy steps.</p>
                
                <ul class="setting-features">
                    <li><i class="fas fa-check"></i> Guardian oversight profile (optional)</li>
                    <li><i class="fas fa-check"></i> Privacy controls</li>
                    <li><i class="fas fa-check"></i> Login security</li>
                    <li><i class="fas fa-check"></i> Data sharing preferences</li>
                </ul>
                
                <a href="/safetynprivacy" class="open-btn">
                    Open <i class="fas fa-arrow-right"></i>
                </a>
            </div>
            
            <!-- Achievements & Progress -->
            <div class="setting-card">
                <h3 class="setting-title">Achievements & Progress</h3>
                <p class="setting-description">See your activities and achievements. Stay motivated as you complete more together.</p>
                
                <ul class="setting-features">
                    <li><i class="fas fa-check"></i> Trophy and badges collection</li>
                    <li><i class="fas fa-check"></i> Progress tracking for consistency</li>
                    <li><i class="fas fa-check"></i> Activity completion stats</li>
                    <li><i class="fas fa-check"></i> Milestone celebrations</li>
                </ul>
                
                <a href="/achievements" class="open-btn">
                    Open <i class="fas fa-arrow-right"></i>
                </a>
            </div>
        </div>
    </section>
    
    <!-- About Me Section -->
    <section class="about-section">
        <h2 class="section-title">
            <i class="fas fa-user"></i> About Me
        </h2>
        
        <div class="about-grid">
            <div class="about-card">
                <h3 class="about-title"><i class="fas fa-id-card"></i> Bio</h3>
                <p class="about-content" id="aboutBio">Student passionate about volunteering. Love running and cooking.</p>
            </div>
            
            <div class="about-card">
                <h3 class="about-title"><i class="fas fa-briefcase"></i> Work</h3>
                <p class="about-content" id="aboutWork">Working part time at Starbucks.</p>
            </div>
            
            <div class="about-card">
                <h3 class="about-title"><i class="fas fa-graduation-cap"></i> Education</h3>
                <p class="about-content" id="aboutEducation">Nanyang Polytechnic, Diploma in Business and Financial Technology</p>
            </div>
            
            <div class="about-card">
                <h3 class="about-title"><i class="fas fa-heart"></i> Relationship</h3>
                <p class="about-content" id="aboutRelationship">Single</p>
            </div>
            
            <div class="about-card">
                <h3 class="about-title"><i class="fas fa-star"></i> Interests</h3>
                <p class="about-content" id="aboutInterests">Running, Cooking, Volunteering, Technology, Finance</p>
            </div>
        </div>
    </section>
</div>

<!-- Edit Profile Modal -->
<div class="modal-overlay" id="editProfileModal">
    <div class="modal">
        <div class="modal-header">
            <h2 class="modal-title">Edit Profile</h2>
            <button class="close-modal" onclick="closeModal()">&times;</button>
        </div>
        
        <form id="profileForm" onsubmit="saveProfile(event)">
            <div class="form-group">
                <label class="form-label" for="editName">Full Name</label>
                <input type="text" class="form-input" id="editName" value="{{ current_user.name if current_user else 'Leon Kennedy' }}" required>
            </div>
            
            <div class="form-group">
                <label class="form-label" for="editEmail">Email Address</label>
                <input type="email" class="form-input" id="editEmail" value="{{ current_user.email if current_user else 'leon.kennedy@gmail.com' }}" required>
                <small style="color: #666; font-size: 13px;">Email must be valid</small>
            </div>
            
            <div class="form-group">
                <label class="form-label" for="editQuote">Profile Quote</label>
                <input type="text" class="form-input" id="editQuote" value="I love running and cooking">
            </div>
            
            <div class="form-group">
                <label class="form-label" for="editBio">Bio</label>
                <textarea class="form-textarea" id="editBio">Student passionate about volunteering. Love running and cooking.</textarea>
            </div>
            
            <div class="form-group">
                <label class="form-label" for="editWork">Work</label>
                <input type="text" class="form-input" id="editWork" value="Working part time at Starbucks">
            </div>
            
            <div class="form-group">
                <label class="form-label" for="editEducation">Education</label>
                <input type="text" class="form-input" id="editEducation" value="Nanyang Polytechnic, Diploma in Business and Financial Technology">
            </div>
            
            <div class="form-group">
                <label class="form-label" for="editRelationship">Relationship</label>
                <input type="text" class="form-input" id="editRelationship" value="Single">
            </div>
            
            <div class="form-group">
                <label class="form-label" for="editInterests">Interests</label>
                <input type="text" class="form-input" id="editInterests" value="Running, Cooking, Volunteering, Technology, Finance">
            </div>
            
            <div class="modal-buttons">
                <button type="button" class="btn btn-secondary" onclick="closeModal()">Cancel</button>
                <button type="submit" class="btn btn-primary">Save Changes</button>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Profile data
    let profileData = {
        name: "{{ current_user.name if current_user else 'Leon Kennedy' }}",
        email: "{{ current_user.email if current_user else 'leon.kennedy@gmail.com' }}",
        quote: "I love running and cooking",
        bio: "Student passionate about volunteering. Love running and cooking.",
        work: "Working part time at Starbucks.",
        education: "Nanyang Polytechnic, Diploma in Business and Financial Technology",
        relationship: "Single",
        interests: "Running, Cooking, Volunteering, Technology, Finance",
        posts: 142,
        followers: 67,
        following: 167,
        profilePic: "{{ url_for('static', filename='images/default-avatar.png') }}"
    };
    
    // Modal functions
    function openModal() {
        document.getElementById('editProfileModal').style.display = 'flex';
        
        // Populate form with current data
        document.getElementById('editName').value = profileData.name;
        document.getElementById('editEmail').value = profileData.email;
        document.getElementById('editQuote').value = profileData.quote.replace(/"/g, '');
        document.getElementById('editBio').value = profileData.bio;
        document.getElementById('editWork').value = profileData.work;
        document.getElementById('editEducation').value = profileData.education;
        document.getElementById('editRelationship').value = profileData.relationship;
        document.getElementById('editInterests').value = profileData.interests;
    }
    
    function closeModal() {
        document.getElementById('editProfileModal').style.display = 'none';
    }
    
    // Save profile changes
    function saveProfile(event) {
        event.preventDefault();
        
        // Get form values
        const name = document.getElementById('editName').value;
        const email = document.getElementById('editEmail').value;
        const quote = document.getElementById('editQuote').value;
        const bio = document.getElementById('editBio').value;
        const work = document.getElementById('editWork').value;
        const education = document.getElementById('editEducation').value;
        const relationship = document.getElementById('editRelationship').value;
        const interests = document.getElementById('editInterests').value;
        
        // Validate email
        if (!validateEmail(email)) {
            alert("Please enter a valid email address.");
            return;
        }
        
        // Update profile data
        profileData.name = name;
        profileData.email = email;
        profileData.quote = `"${quote}"`;
        profileData.bio = bio;
        profileData.work = work;
        profileData.education = education;
        profileData.relationship = relationship;
        profileData.interests = interests;
        
        // Update UI
        updateProfileUI();
        
        // Close modal
        closeModal();
        
        // Show success message
        alert("Profile updated successfully!");
        
        // Here you would typically send the data to your backend
        // Example: fetch('/update-profile', { method: 'POST', body: JSON.stringify(profileData) })
    }
    
    // Update UI with profile data
    function updateProfileUI() {
        document.getElementById('profileName').textContent = profileData.name;
        document.getElementById('profileEmail').textContent = profileData.email;
        document.getElementById('profileQuote').textContent = profileData.quote;
        document.getElementById('aboutBio').textContent = profileData.bio;
        document.getElementById('aboutWork').textContent = profileData.work;
        document.getElementById('aboutEducation').textContent = profileData.education;
        document.getElementById('aboutRelationship').textContent = profileData.relationship;
        document.getElementById('aboutInterests').textContent = profileData.interests;
        document.getElementById('postCount').textContent = profileData.posts;
        document.getElementById('followerCount').textContent = profileData.followers;
        document.getElementById('followingCount').textContent = profileData.following;
        document.getElementById('profilePicture').src = profileData.profilePic;
    }
    
    // Email validation function
    function validateEmail(email) {
        const re = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
        return re.test(String(email).toLowerCase());
    }
    
    // Change profile picture
    document.addEventListener('DOMContentLoaded', function() {
        const profilePic = document.getElementById('profilePicture');
        if (profilePic) {
            profilePic.addEventListener('click', function() {
                const newPic = prompt("Enter URL for new profile picture:", profileData.profilePic);
                if (newPic && newPic.trim() !== "") {
                    profileData.profilePic = newPic.trim();
                    updateProfileUI();
                }
            });
        }
        
        // Close modal when clicking outside
        const modalOverlay = document.getElementById('editProfileModal');
        if (modalOverlay) {
            modalOverlay.addEventListener('click', function(e) {
                if (e.target === this) {
                    closeModal();
                }
            });
        }
        
        // Initialize UI with profile data
        updateProfileUI();
    });
</script>
{% endblock %}