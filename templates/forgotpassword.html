{% extends "base.html" %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/forgotpassword.css') }}">
{% endblock %}

{% block content %}
<div class="forgot-password-container">
  <form id="forgotPasswordForm" action="{{ url_for('forgotpassword') }}" method="POST" novalidate>

    <div class="back-link">
      <a href="{{ url_for('loginpage') }}">
        <i class="fa-solid fa-arrow-left"></i> Back to Login
      </a>
    </div>

    <h1>Forgot Password?</h1>
    <p class="subtitle">No worries! Enter your email and we'll help you reset your password.</p>

    <!-- Email -->
    <div class="form-group">
      <label>Email Address</label>
      <div class="input-wrapper">
        <i class="fa-solid fa-envelope"></i>
        <input type="email" id="email" name="email" placeholder="you@example.com" required>
      </div>
      <small class="error" id="emailError"></small>
    </div>

    <!-- New Password -->
    <div class="form-group">
      <label>New Password</label>
      <div class="input-wrapper">
        <i class="fa-solid fa-lock"></i>
        <input type="password" id="newPassword" name="newPassword" placeholder="Enter new password (min. 6 characters)" minlength="6" required>
        <i class="fa-solid fa-eye toggle-eye" id="toggleNewPassword"></i>
      </div>
      <small class="error" id="newPasswordError"></small>
    </div>

    <!-- Confirm New Password -->
    <div class="form-group">
      <label>Confirm New Password</label>
      <div class="input-wrapper">
        <i class="fa-solid fa-lock"></i>
        <input type="password" id="confirmPassword" name="confirmPassword" placeholder="Confirm your new password" minlength="6" required>
        <i class="fa-solid fa-eye toggle-eye" id="toggleConfirmPassword"></i>
      </div>
      <small class="error" id="confirmPasswordError"></small>
    </div>

    <button type="submit" id="resetBtn" disabled>
      <i class="fa-solid fa-key"></i> Reset Password
    </button>

    <div class="info-box">
      <i class="fa-solid fa-circle-info"></i>
      <p>Your password must be at least 6 characters long and match in both fields.</p>
    </div>

  </form>
</div>

{% endblock %}

{% block extra_js %}

<script>
  const email = document.getElementById("email");
  const newPassword = document.getElementById("newPassword");
  const confirmPassword = document.getElementById("confirmPassword");
  const resetBtn = document.getElementById("resetBtn");
  const toggleNewPassword = document.getElementById("toggleNewPassword");
  const toggleConfirmPassword = document.getElementById("toggleConfirmPassword");
  const emailError = document.getElementById("emailError");
  const newPasswordError = document.getElementById("newPasswordError");
  const confirmPasswordError = document.getElementById("confirmPasswordError");

  function validateForm() {
    let valid = true;

    // Validate email
    if (!email.checkValidity()) {
      emailError.textContent = "Please enter a valid email address.";
      valid = false;
    } else {
      emailError.textContent = "";
    }

    // Validate new password
    if (newPassword.value.length < 6) {
      newPasswordError.textContent = "Password must be at least 6 characters.";
      valid = false;
    } else {
      newPasswordError.textContent = "";
    }

    // Validate password match
    if (confirmPassword.value !== newPassword.value) {
      confirmPasswordError.textContent = "Passwords do not match.";
      valid = false;
    } else {
      confirmPasswordError.textContent = "";
    }

    resetBtn.disabled = !valid;
  }

  email.addEventListener("input", validateForm);
  newPassword.addEventListener("input", validateForm);
  confirmPassword.addEventListener("input", validateForm);

  // Toggle password visibility for new password
  toggleNewPassword.addEventListener("click", () => {
    const hidden = newPassword.type === "password";
    newPassword.type = hidden ? "text" : "password";
    toggleNewPassword.classList.toggle("fa-eye");
    toggleNewPassword.classList.toggle("fa-eye-slash");
  });

  // Toggle password visibility for confirm password
  toggleConfirmPassword.addEventListener("click", () => {
    const hidden = confirmPassword.type === "password";
    confirmPassword.type = hidden ? "text" : "password";
    toggleConfirmPassword.classList.toggle("fa-eye");
    toggleConfirmPassword.classList.toggle("fa-eye-slash");
  });
</script>
{% endblock %}