{% extends "base.html" %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/safetynprivacy.css') }}">
{% endblock %}

{% block content %}
<div class="safety-privacy-container">
    <!-- Header with back button -->
    <div class="safety-privacy-header">
        <a href="{{ url_for('profile') }}" class="back-button" aria-label="Go back to profile">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M15 18L9 12L15 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
        </a>
        <div class="header-content">
            <h1>Safety & Privacy</h1>
            <p class="subtitle">Manage your account security and privacy preferences</p>
        </div>
    </div>

    <!-- Guardian Oversight Section - EMPTY STATE -->
    <section class="settings-section guardian-section">
        <div class="section-header">
            <div class="icon-wrapper">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 2L2 7V12C2 16.97 5.51 21.56 12 23C18.49 21.56 22 16.97 22 12V7L12 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M9 12L11 14L15 10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </div>
            <div class="section-title-group">
                <h2>Guardian Oversight</h2>
            </div>
        </div>
        
        <p class="section-description">A guardian can help monitor your account for safety. They'll receive activity reports and can assist with security concerns. You can add or remove your guardian at any time.</p>
        
        <!-- Empty State -->
        <div class="empty-guardian-state">
            <svg width="80" height="80" viewBox="0 0 80 80" fill="none" xmlns="http://www.w3.org/2000/svg">
                <circle cx="40" cy="40" r="40" fill="#F3F4F6"/>
                <path d="M40 20L25 30V45C25 52.5 30 58 40 60C50 58 55 52.5 55 45V30L40 20Z" stroke="#9CA3AF" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M35 40L38 43L45 36" stroke="#9CA3AF" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <h3>No Guardian Assigned</h3>
            <p>You haven't added a guardian yet. A guardian can help monitor your account for safety and security.</p>
            <button class="add-guardian-btn" onclick="alert('Add Guardian feature - Coming soon! This will allow you to select a guardian who is 30+ years old.')">
                <i class="fas fa-user-plus"></i> Add Guardian
            </button>
        </div>
    </section>

    <!-- Report User Section - NEW -->
    <section class="settings-section report-section">
        <div class="section-header">
            <div class="icon-wrapper report-icon">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M10.29 3.86L1.82 18C1.64537 18.3024 1.55296 18.6453 1.55199 18.9945C1.55101 19.3437 1.64151 19.6871 1.81445 19.9905C1.98738 20.2939 2.23675 20.5467 2.53773 20.7239C2.83871 20.901 3.18082 20.9962 3.53 21H20.47C20.8192 20.9962 21.1613 20.901 21.4623 20.7239C21.7633 20.5467 22.0126 20.2939 22.1856 19.9905C22.3585 19.6871 22.449 19.3437 22.448 18.9945C22.447 18.6453 22.3546 18.3024 22.18 18L13.71 3.86C13.5317 3.56611 13.2807 3.32312 12.9812 3.15448C12.6817 2.98585 12.3437 2.89725 12 2.89725C11.6563 2.89725 11.3183 2.98585 11.0188 3.15448C10.7193 3.32312 10.4683 3.56611 10.29 3.86Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <line x1="12" y1="9" x2="12" y2="13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <circle cx="12" cy="17" r="1" fill="currentColor"/>
                </svg>
            </div>
            <h2>Report User</h2>
        </div>
        
        <p class="section-description">If you encounter inappropriate behavior or content, please report it here. Your report will be reviewed by our safety team.</p>
        
        <!-- Report Form -->
        <form id="reportForm" class="report-form">
            <div class="form-row">
                <div class="form-group">
                    <label for="reporterName">Your Name *</label>
                    <input type="text" id="reporterName" name="reporterName" required placeholder="Enter your full name">
                </div>
                <div class="form-group">
                    <label for="reporterEmail">Your Email *</label>
                    <input type="email" id="reporterEmail" name="reporterEmail" required placeholder="your.email@example.com">
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="reporterAge">Your Age *</label>
                    <input type="number" id="reporterAge" name="reporterAge" required placeholder="Enter your age" min="1" max="120">
                </div>
                <div class="form-group">
                    <label for="reportedUserId">User ID to Report *</label>
                    <input type="text" id="reportedUserId" name="reportedUserId" required placeholder="Enter user ID (e.g., USR-A1B2C3)" pattern="USR-[A-Z0-9]{6}" title="Please enter a valid User ID in format: USR-XXXXXX">
                    <small style="color: #666; font-size: 12px; margin-top: 4px; display: block;">Enter the unique User ID of the person you want to report</small>
                </div>
            </div>

            <div class="form-group">
                <label for="reportReason">Reason for Report *</label>
                <textarea id="reportReason" name="reportReason" required placeholder="Please describe the issue in detail..." rows="5"></textarea>
            </div>

            <div class="form-actions">
                <button type="button" class="btn-secondary" onclick="document.getElementById('reportForm').reset()">Clear Form</button>
                <button type="submit" class="btn-primary">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M14 2L7 9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M14 2L10 14L7 9L2 6L14 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    Submit Report
                </button>
            </div>
        </form>
    </section>

    <!-- Privacy Controls Section -->
    <section class="settings-section privacy-section">
        <div class="section-header">
            <div class="icon-wrapper">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <rect x="3" y="11" width="18" height="11" rx="2" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M7 11V7C7 5.67392 7.52678 4.40215 8.46447 3.46447C9.40215 2.52678 10.6739 2 12 2C13.3261 2 14.5979 2.52678 15.5355 3.46447C16.4732 4.40215 17 5.67392 17 7V11" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </div>
            <h2>Privacy Controls</h2>
        </div>
        
        <p class="section-description">Control who can see your information and interact with you on the platform.</p>
        
        <div class="privacy-control">
            <div class="control-info">
                <h3>Profile Visibility</h3>
                <p>Choose who can see your profile information and posts</p>
            </div>
            <div class="dropdown-control">
                <select id="profileVisibility" class="privacy-dropdown">
                    <option value="everyone">Everyone</option>
                    <option value="friends" selected>Friends Only</option>
                    <option value="private">Only Me</option>
                </select>
            </div>
        </div>
        
        <div class="privacy-control">
            <div class="control-info">
                <h3>Data Sharing</h3>
                <p>Allow your data to be used for personalized recommendations</p>
            </div>
            <label class="toggle-switch">
                <input type="checkbox" id="dataSharing" checked>
                <span class="toggle-slider"></span>
            </label>
        </div>
        
        <div class="privacy-control">
            <div class="control-info">
                <h3>Search Visibility</h3>
                <p>Allow your profile to appear in search results</p>
            </div>
            <label class="toggle-switch">
                <input type="checkbox" id="searchVisibility" checked>
                <span class="toggle-slider"></span>
            </label>
        </div>
    </section>

    <!-- Security Settings Section -->
    <section class="settings-section security-section">
        <div class="section-header">
            <div class="icon-wrapper">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 22C12 22 20 18 20 12V5L12 2L4 5V12C4 18 12 22 12 22Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </div>
            <h2>Security Settings</h2>
        </div>
        
        <p class="section-description">Enhance your account security with these advanced protection features.</p>
        
        <div class="security-control">
            <div class="control-info">
                <h3>Two-Factor Authentication</h3>
                <p>Add an extra layer of security to your account</p>
            </div>
            <label class="toggle-switch">
                <input type="checkbox" id="twoFactor">
                <span class="toggle-slider"></span>
            </label>
        </div>
        
        <div class="security-control">
            <div class="control-info">
                <h3>Login Notifications</h3>
                <p>Get notified when someone logs into your account from a new device</p>
            </div>
            <label class="toggle-switch">
                <input type="checkbox" id="loginNotifications" checked>
                <span class="toggle-slider"></span>
            </label>
        </div>
        
        <div class="security-control">
            <div class="control-info">
                <h3>Location Services</h3>
                <p>Allow the app to access your location for personalised features</p>
            </div>
            <label class="toggle-switch">
                <input type="checkbox" id="locationServices">
                <span class="toggle-slider"></span>
            </label>
        </div>
    </section>
</div>

<!-- Success Modal -->
<div id="successModal" class="modal">
    <div class="modal-content success-modal">
        <div class="success-icon">
            <svg width="60" height="60" viewBox="0 0 60 60" fill="none" xmlns="http://www.w3.org/2000/svg">
                <circle cx="30" cy="30" r="28" fill="#22C55E" stroke="#16A34A" stroke-width="4"/>
                <path d="M18 30L26 38L42 22" stroke="white" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
        </div>
        <h2>Report Submitted Successfully!</h2>
        <p>Thank you for helping keep our community safe. Our team will review your report and take appropriate action.</p>
        <button class="close-success-btn" onclick="closeSuccessModal()">Close</button>
    </div>
</div>

<script>
    // Privacy Settings (localStorage)
    const profileVisibility = document.getElementById('profileVisibility');
    const savedVisibility = localStorage.getItem('profileVisibility') || 'friends';
    profileVisibility.value = savedVisibility;

    profileVisibility.addEventListener('change', () => {
        localStorage.setItem('profileVisibility', profileVisibility.value);
    });

    const dataSharing = document.getElementById('dataSharing');
    const savedDataSharing = localStorage.getItem('dataSharing') !== 'false';
    dataSharing.checked = savedDataSharing;

    dataSharing.addEventListener('change', () => {
        localStorage.setItem('dataSharing', dataSharing.checked);
    });

    const searchVisibility = document.getElementById('searchVisibility');
    const savedSearchVisibility = localStorage.getItem('searchVisibility') !== 'false';
    searchVisibility.checked = savedSearchVisibility;

    searchVisibility.addEventListener('change', () => {
        localStorage.setItem('searchVisibility', searchVisibility.checked);
    });

    const twoFactor = document.getElementById('twoFactor');
    const savedTwoFactor = localStorage.getItem('twoFactor') === 'true';
    twoFactor.checked = savedTwoFactor;

    twoFactor.addEventListener('change', () => {
        localStorage.setItem('twoFactor', twoFactor.checked);
        if (twoFactor.checked) {
            alert('Two-Factor Authentication has been enabled. You will receive a verification code on your registered device.');
        }
    });

    const loginNotifications = document.getElementById('loginNotifications');
    const savedLoginNotifications = localStorage.getItem('loginNotifications') !== 'false';
    loginNotifications.checked = savedLoginNotifications;

    loginNotifications.addEventListener('change', () => {
        localStorage.setItem('loginNotifications', loginNotifications.checked);
    });

    const locationServices = document.getElementById('locationServices');
    const savedLocationServices = localStorage.getItem('locationServices') === 'true';
    locationServices.checked = savedLocationServices;

    locationServices.addEventListener('change', () => {
        localStorage.setItem('locationServices', locationServices.checked);
        if (locationServices.checked) {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        console.log('Location access granted');
                    },
                    (error) => {
                        console.log('Location access denied');
                        locationServices.checked = false;
                        localStorage.setItem('locationServices', false);
                    }
                );
            }
        }
    });

    // Report Form Submission
    const reportForm = document.getElementById('reportForm');
    const successModal = document.getElementById('successModal');

    reportForm.addEventListener('submit', (e) => {
        e.preventDefault();
        
        // TODO: Later, send this data to the database
        // For now, just show success message
        
        const formData = {
            reporterName: document.getElementById('reporterName').value,
            reporterEmail: document.getElementById('reporterEmail').value,
            reporterAge: document.getElementById('reporterAge').value,
            reportedUserId: document.getElementById('reportedUserId').value,
            reportReason: document.getElementById('reportReason').value,
            timestamp: new Date().toISOString()
        };
        
        console.log('Report submitted:', formData);
        
        // Show success modal
        successModal.style.display = 'flex';
    });

    function closeSuccessModal() {
        const successModal = document.getElementById('successModal');
        const reportForm = document.getElementById('reportForm');
        
        // Close modal
        successModal.style.display = 'none';
        
        // Reset form
        reportForm.reset();
    }

    // Close modal when clicking outside
    window.addEventListener('click', (e) => {
        if (e.target === successModal) {
            closeSuccessModal();
        }
    });
</script>
{% endblock %}