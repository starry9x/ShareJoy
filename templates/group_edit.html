{% extends "base.html" %}

{% block extra_css %}
<style>
    body {
        background-color: #FFF8E1;
    }

    .edit-container {
        max-width: 900px;
        margin: 40px auto;
        padding: 40px;
        background-color: white;
        border-radius: 20px;
        box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }

    .edit-header {
        text-align: center;
        margin-bottom: 40px;
    }

    .back-link {
        display: inline-block;
        background-color: #8D6E63;
        color: white;
        padding: 10px 20px;
        border-radius: 10px;
        text-decoration: none;
        font-weight: 600;
        margin-bottom: 20px;
    }

    .back-link:hover {
        background-color: #6D4C41;
        color: white;
    }

    .edit-title {
        font-size: 2rem;
        font-weight: 800;
        color: #3E2723;
    }

    .form-section {
        margin-bottom: 30px;
    }

    .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin-bottom: 20px;
    }

    .form-group {
        display: flex;
        flex-direction: column;
    }

    .form-label {
        font-weight: 700;
        color: #3E2723;
        margin-bottom: 8px;
        font-size: 1rem;
    }

    .required {
        color: #D32F2F;
    }

    .form-input,
    .form-select,
    .form-textarea {
        padding: 12px 15px;
        border: 1px solid #BDBDBD;
        border-radius: 8px;
        font-size: 1rem;
        font-family: inherit;
        outline: none;
        transition: border 0.2s;
    }

    .form-input:focus,
    .form-select:focus,
    .form-textarea:focus {
        border-color: #FF8A65;
    }

    .form-input.error,
    .form-textarea.error {
        border-color: #D32F2F;
        background-color: #FFEBEE;
    }

    .form-input.success,
    .form-textarea.success {
        border-color: #4CAF50;
        background-color: #E8F5E9;
    }

    .error-message {
        color: #D32F2F;
        font-size: 0.85rem;
        margin-top: 5px;
        display: none;
        font-weight: 600;
    }

    .error-message.show {
        display: block;
    }

    .char-counter {
        font-size: 0.85rem;
        color: #757575;
        text-align: right;
        margin-top: 5px;
    }

    .char-counter.warning {
        color: #FF6F00;
        font-weight: 700;
    }

    .char-counter.error {
        color: #D32F2F;
        font-weight: 700;
    }

    .form-textarea {
        resize: vertical;
        min-height: 120px;
    }

    .avatar-section {
        display: flex;
        align-items: center;
        gap: 20px;
        margin-bottom: 30px;
    }

    .avatar-preview {
        width: 120px;
        height: 120px;
        border-radius: 50%;
        background-color: #E0E0E0;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 3rem;
        color: #757575;
        overflow: hidden;
    }

    .avatar-preview img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .privacy-buttons {
        display: flex;
        gap: 15px;
    }

    .privacy-btn {
        flex: 1;
        padding: 15px;
        border: 2px solid #BDBDBD;
        border-radius: 10px;
        background-color: white;
        cursor: pointer;
        font-size: 1rem;
        font-weight: 600;
        transition: all 0.2s;
        text-align: center;
    }

    .privacy-btn.active {
        border-color: #FF8A65;
        background-color: #FFF3E0;
        color: #D84315;
    }

    .privacy-btn input[type="radio"] {
        display: none;
    }

    .privacy-btn:hover {
        border-color: #FF8A65;
    }

    .btn-save {
        background-color: #FFAB91;
        border: 2px solid #FF8A65;
        color: #3E2723;
        font-weight: 800;
        font-size: 1.2rem;
        padding: 15px 50px;
        border-radius: 12px;
        cursor: pointer;
        box-shadow: 0 4px 0 #D84315;
        transition: transform 0.1s;
        width: 100%;
        margin-top: 20px;
    }

    .btn-save:hover {
        transform: translateY(2px);
        box-shadow: 0 2px 0 #D84315;
    }

    @media (max-width: 768px) {
        .form-row {
            grid-template-columns: 1fr;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="edit-container">
    <div class="edit-header">
        <a href="{{ url_for('group_settings', group_id=group.id) }}" class="back-link">
            <i class="fa-solid fa-arrow-left"></i> Back to Settings
        </a>
        <h1 class="edit-title">Group Details</h1>
    </div>

    <form method="POST">
        <!-- Avatar Section -->
        <div class="avatar-section">
            <div class="avatar-preview">
                {% if 'board' in group.name.lower() %}
                    <i class="fa-solid fa-chess-board"></i>
                {% elif 'walk' in group.name.lower() or 'nature' in group.name.lower() %}
                    <i class="fa-solid fa-person-hiking"></i>
                {% else %}
                    <i class="fa-solid fa-users"></i>
                {% endif %}
            </div>
        </div>

        <!-- Form Fields -->
        <div class="form-row">
            <div class="form-group">
                <label class="form-label">Group Name <span class="required">*</span></label>
                <input type="text" name="name" id="groupName" class="form-input" value="{{ group.name }}" maxlength="100" required>
                <div class="char-counter" id="nameCounter">{{ group.name|length }} / 100 characters</div>
                <div class="error-message" id="nameError">Please enter a group name between 3 and 100 characters.</div>
            </div>

            <div class="form-group">
                <label class="form-label">Group Category <span class="required">*</span></label>
                <input type="text" name="category" id="groupCategory" class="form-input" value="{{ group.category }}" maxlength="50" required>
                <div class="char-counter" id="categoryCounter">{{ group.category|length }} / 50 characters</div>
                <div class="error-message" id="categoryError">Please enter a category between 2 and 50 characters.</div>
            </div>
        </div>

        <div class="form-group">
            <label class="form-label">Description <span class="required">*</span></label>
            <textarea name="description" id="groupDescription" class="form-textarea" maxlength="500" required>{{ group.description }}</textarea>
            <div class="char-counter" id="descCounter">{{ group.description|length }} / 500 characters</div>
            <div class="error-message" id="descError">Please enter a description between 10 and 500 characters.</div>
        </div>

        <div class="form-row">
            <div class="form-group">
                <label class="form-label">Group Size <span class="required">*</span></label>
                <input type="number" name="max_participants" id="maxParticipants" class="form-input" value="{{ group.max_participants }}" min="1" max="500" required>
                <div class="error-message" id="participantsError">Please enter a number between 1 and 500.</div>
            </div>

            <div class="form-group">
                <label class="form-label">Group Privacy <span class="required">*</span></label>
                <div class="privacy-buttons">
                    <label class="privacy-btn {% if group.privacy == 'Public' %}active{% endif %}">
                        <input type="radio" name="privacy" value="Public" {% if group.privacy == 'Public' %}checked{% endif %}>
                        Public
                    </label>
                    <label class="privacy-btn {% if group.privacy == 'Private' %}active{% endif %}">
                        <input type="radio" name="privacy" value="Private" {% if group.privacy == 'Private' %}checked{% endif %}>
                        Private
                    </label>
                </div>
            </div>
        </div>

        <button type="submit" class="btn-save">Save</button>
    </form>
</div>

<script>
    // ========== Real-time Field Validation ==========

    // Group Name Validation
    const groupNameInput = document.getElementById('groupName');
    const nameCounter = document.getElementById('nameCounter');
    const nameError = document.getElementById('nameError');

    groupNameInput.addEventListener('input', function() {
        const length = this.value.length;
        nameCounter.textContent = `${length} / 100 characters`;

        if (length > 90) {
            nameCounter.classList.add('warning');
        } else {
            nameCounter.classList.remove('warning');
        }

        if (length === 0) {
            this.classList.remove('success', 'error');
            nameError.classList.remove('show');
        } else if (length < 3) {
            this.classList.add('error');
            this.classList.remove('success');
            nameError.textContent = 'Group name must be at least 3 characters long.';
            nameError.classList.add('show');
        } else if (length > 100) {
            this.classList.add('error');
            this.classList.remove('success');
            nameError.textContent = 'Group name cannot exceed 100 characters.';
            nameError.classList.add('show');
        } else {
            this.classList.add('success');
            this.classList.remove('error');
            nameError.classList.remove('show');
        }
    });

    // Category Validation
    const categoryInput = document.getElementById('groupCategory');
    const categoryCounter = document.getElementById('categoryCounter');
    const categoryError = document.getElementById('categoryError');

    categoryInput.addEventListener('input', function() {
        const length = this.value.length;
        categoryCounter.textContent = `${length} / 50 characters`;

        if (length > 45) {
            categoryCounter.classList.add('warning');
        } else {
            categoryCounter.classList.remove('warning');
        }

        if (length === 0) {
            this.classList.remove('success', 'error');
            categoryError.classList.remove('show');
        } else if (length < 2) {
            this.classList.add('error');
            this.classList.remove('success');
            categoryError.textContent = 'Category must be at least 2 characters long.';
            categoryError.classList.add('show');
        } else if (length > 50) {
            this.classList.add('error');
            this.classList.remove('success');
            categoryError.textContent = 'Category cannot exceed 50 characters.';
            categoryError.classList.add('show');
        } else {
            this.classList.add('success');
            this.classList.remove('error');
            categoryError.classList.remove('show');
        }
    });

    // Description Validation
    const descInput = document.getElementById('groupDescription');
    const descCounter = document.getElementById('descCounter');
    const descError = document.getElementById('descError');

    descInput.addEventListener('input', function() {
        const length = this.value.length;
        descCounter.textContent = `${length} / 500 characters`;

        if (length > 450) {
            descCounter.classList.add('warning');
        } else {
            descCounter.classList.remove('warning');
        }

        if (length > 490) {
            descCounter.classList.add('error');
            descCounter.classList.remove('warning');
        } else {
            descCounter.classList.remove('error');
        }

        if (length === 0) {
            this.classList.remove('success', 'error');
            descError.classList.remove('show');
        } else if (length < 10) {
            this.classList.add('error');
            this.classList.remove('success');
            descError.textContent = 'Description must be at least 10 characters long.';
            descError.classList.add('show');
        } else if (length > 500) {
            this.classList.add('error');
            this.classList.remove('success');
            descError.textContent = 'Description cannot exceed 500 characters.';
            descError.classList.add('show');
        } else {
            this.classList.add('success');
            this.classList.remove('error');
            descError.classList.remove('show');
        }
    });

    // Max Participants Validation
    const participantsInput = document.getElementById('maxParticipants');
    const participantsError = document.getElementById('participantsError');

    participantsInput.addEventListener('input', function() {
        const value = parseInt(this.value);

        if (isNaN(value)) {
            this.classList.remove('success', 'error');
            participantsError.classList.remove('show');
        } else if (value < 1) {
            this.classList.add('error');
            this.classList.remove('success');
            participantsError.textContent = 'Group must allow at least 1 participant.';
            participantsError.classList.add('show');
        } else if (value > 500) {
            this.classList.add('error');
            this.classList.remove('success');
            participantsError.textContent = 'Maximum participants cannot exceed 500.';
            participantsError.classList.add('show');
        } else {
            this.classList.add('success');
            this.classList.remove('error');
            participantsError.classList.remove('show');
        }
    });

    // Handle privacy button active state
    document.querySelectorAll('.privacy-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            document.querySelectorAll('.privacy-btn').forEach(b => b.classList.remove('active'));
            this.classList.add('active');
        });
    });

    // Form submission validation
    document.querySelector('form').addEventListener('submit', function(e) {
        let isValid = true;

        // Validate group name
        const nameValue = groupNameInput.value.trim();
        if (nameValue.length < 3 || nameValue.length > 100) {
            groupNameInput.classList.add('error');
            nameError.classList.add('show');
            isValid = false;
        }

        // Validate category
        const categoryValue = categoryInput.value.trim();
        if (categoryValue.length < 2 || categoryValue.length > 50) {
            categoryInput.classList.add('error');
            categoryError.classList.add('show');
            isValid = false;
        }

        // Validate description
        const descValue = descInput.value.trim();
        if (descValue.length < 10 || descValue.length > 500) {
            descInput.classList.add('error');
            descError.classList.add('show');
            isValid = false;
        }

        // Validate max participants
        const participantsValue = parseInt(participantsInput.value);
        if (isNaN(participantsValue) || participantsValue < 1 || participantsValue > 500) {
            participantsInput.classList.add('error');
            participantsError.classList.add('show');
            isValid = false;
        }

        if (!isValid) {
            e.preventDefault();
            alert('Please fix the errors in the form before submitting.');
            const firstError = document.querySelector('.error');
            if (firstError) {
                firstError.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        }
    });
</script>
{% endblock %}
